{"remainingRequest":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Learn\\blog-person\\src\\components\\SubmitBlog.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Learn\\blog-person\\src\\components\\SubmitBlog.vue","mtime":1578215932234},{"path":"D:\\Learn\\blog-person\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1572976728968},{"path":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js","mtime":1577118252216}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bWFwU3RhdGV9IGZyb20gInZ1ZXgiCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJTdWJtaXRCbG9nIiwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZmllbGRzOiB7CiAgICAgICAgICAgICAgICB0aXRsZTogIiIsCiAgICAgICAgICAgICAgICB0YWdzOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICBydWxlczogewogICAgICAgICAgICAgICAgdGl0bGU6IHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRhZ3M6IHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogIuS4jeiDveS4uuepuiIsIHRyaWdnZXI6ICJibHVyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgLi4ubWFwU3RhdGUoewogICAgICAgICAgICBjb250ZW50OiBzdGF0ZSA9PiBzdGF0ZS5ibG9nLmVkaXRvckNvbnRlbnQKICAgICAgICB9KQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICAgZ2V0U3RySWQgKHRhcmdldCwgcmFuZ2UpIHsKICAgICAgICAgICAgIGxldCBhcnIgPSBbXTsKICAgICAgICAgICAgIGxldCBpZCA9IHRhcmdldDsKICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFuZ2U7IGkgKyspIHsKICAgICAgICAgICAgICAgICBhcnIucHVzaChpZCsrKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJldHVybiBhcnIuam9pbigiLCIpOwogICAgICAgICB9LAogICAgICAgICBlZGl0QmxvZyAodGl0bGUsIHRhZ3MsIHJlc3VsdCkgewogICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXhpb3MoewogICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICAgICAgIHVybDogJy9lZGl0QmxvZycsCiAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICB0aXRsZSwKICAgICAgICAgICAgICAgICAgICAgdGFncywKICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgICAgICBjdGltZTogbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9KQogICAgICAgICB9LAogICAgICAgICBpbnNlcnRUYWdCbG9nTWFwIChyZXMpIHsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqICDmj5LlhaXmoIfnrb7mmKDlsIQKICAgICAgICAgICAgICogKi8KICAgICAgICAgICAgIGxldCBsZW4gPSByZXMuZGF0YS5sZW5ndGg7CiAgICAgICAgICAgICBsZXQgdGFnc1Jlc3VsdCA9IHJlcy5kYXRhW2xlbiAtIDFdOyAvLyDmnIDlkI7kuIDmnaFpbnNlcnTnmoTov5Tlm57nu5PmnpwKICAgICAgICAgICAgIGxldCBpZFN0ciA9IHRoaXMuZ2V0U3RySWQodGFnc1Jlc3VsdC5pbnNlcnRJZCwgdGFnc1Jlc3VsdC5hZmZlY3RlZFJvd3MpOwogICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXhpb3MoewogICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICAgICAgIHVybDogJy9pbnNlcnRUYWdCbG9nTWFwJywKICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgIGJsb2dJZDogcmVzLmRhdGFbbGVuIC0gMl0uaW5zZXJ0SWQsIC8v5L+d5a2Y5paH56ug5oiQ5Yqf5pe25Lyg5Zue5p2l55qEaWQo5YCS5pWw56ys5LqM5p2haW5zZXJ0KQogICAgICAgICAgICAgICAgICAgICBpZFN0ciwKICAgICAgICAgICAgICAgICAgICAgY3RpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSkKICAgICAgICAgfSwKICAgICAgICAgc3VibWl0Rm9ybSAoZm9ybU5hbWUpIHsKICAgICAgICAgICAgIHRoaXMuJHJlZnNbZm9ybU5hbWVdLnZhbGlkYXRlKGFzeW5jICh2YWxpZCkgPT4gewogICAgICAgICAgICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgICAgICAgICAgICBsZXQge3RpdGxlLCB0YWdzfSA9IHRoaXMuZmllbGRzOwogICAgICAgICAgICAgICAgICAgICB0YWdzID0gdGFncy5yZXBsYWNlKC/vvIwvZywgJywnKTsgLy8g6Iux5paH6L2s5Lit5paHCiAgICAgICAgICAgICAgICAgICAgIGxldCBpbnNlcnRCbG9nUmVzdWx0ID0gYXdhaXQgdGhpcy5lZGl0QmxvZyh0aXRsZSwgdGFncywgdGhpcy5jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgbGV0IHRhZ0Jsb2dNYXBSZXN1bHQgPSAgYXdhaXQgdGhpcy5pbnNlcnRUYWdCbG9nTWFwKGluc2VydEJsb2dSZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICBpZiAodGFnQmxvZ01hcFJlc3VsdC5zdGF0dXMgPT09IDIwMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuaPkuWFpeaIkOWKnyEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzLnRhZ3MgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzLnRpdGxlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoImJsb2cvdXBkYXRlQ29udGVudCIsICcnKTsgLy8g5pu05paw5paH56ug54q25oCB5YaF5a65CiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdyZWZyZXNoSG9tZScpOwogICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLmj5LlhaXlpLHotKUhIik7CiAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIHN1Ym1pdCEhJyk7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["SubmitBlog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SubmitBlog.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n    <el-form label-position=\"top\" label-width=\"80px\" :model=\"fields\" ref=\"ruleForm\" :rules=\"rules\">\r\n        <el-form-item label=\"标题\" prop=\"title\">\r\n            <el-input clearable v-model=\"fields.title\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"标签\" prop=\"tags\">\r\n            <el-input clearable v-model=\"fields.tags\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item>\r\n            <el-button @click=\"submitForm('ruleForm')\" type=\"primary\">提交</el-button>\r\n        </el-form-item>\r\n    </el-form>\r\n</template>\r\n\r\n<script>\r\n    import {mapState} from \"vuex\"\r\n    export default {\r\n        name: \"SubmitBlog\",\r\n        data() {\r\n            return {\r\n                fields: {\r\n                    title: \"\",\r\n                    tags: \"\"\r\n                },\r\n                rules: {\r\n                    title: {\r\n                        required: true, message: \"不能为空\", trigger: \"blur\"\r\n                    },\r\n                    tags: {\r\n                        required: true, message: \"不能为空\", trigger: \"blur\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        computed: {\r\n            ...mapState({\r\n                content: state => state.blog.editorContent\r\n            })\r\n        },\r\n        methods: {\r\n             getStrId (target, range) {\r\n                 let arr = [];\r\n                 let id = target;\r\n                 for (let i = 0; i < range; i ++) {\r\n                     arr.push(id++);\r\n                 }\r\n                 return arr.join(\",\");\r\n             },\r\n             editBlog (title, tags, result) {\r\n                 return this.axios({\r\n                     method: 'post',\r\n                     url: '/editBlog',\r\n                     data: {\r\n                         title,\r\n                         tags,\r\n                         result,\r\n                         ctime: new Date().getTime()\r\n                     }\r\n                 })\r\n             },\r\n             insertTagBlogMap (res) {\r\n                 /*\r\n                 *  插入标签映射\r\n                 * */\r\n                 let len = res.data.length;\r\n                 let tagsResult = res.data[len - 1]; // 最后一条insert的返回结果\r\n                 let idStr = this.getStrId(tagsResult.insertId, tagsResult.affectedRows);\r\n                 return this.axios({\r\n                     method: 'post',\r\n                     url: '/insertTagBlogMap',\r\n                     data: {\r\n                         blogId: res.data[len - 2].insertId, //保存文章成功时传回来的id(倒数第二条insert)\r\n                         idStr,\r\n                         ctime: new Date().getTime()\r\n                     }\r\n                 })\r\n             },\r\n             submitForm (formName) {\r\n                 this.$refs[formName].validate(async (valid) => {\r\n                     if (valid) {\r\n                         let {title, tags} = this.fields;\r\n                         tags = tags.replace(/，/g, ','); // 英文转中文\r\n                         let insertBlogResult = await this.editBlog(title, tags, this.content);\r\n                         let tagBlogMapResult =  await this.insertTagBlogMap(insertBlogResult);\r\n                         if (tagBlogMapResult.status === 200){\r\n                             this.$message.success(\"插入成功!\");\r\n                             this.fields.tags = '';\r\n                             this.fields.title = '';\r\n                             this.$store.commit(\"blog/updateContent\", ''); // 更新文章状态内容\r\n                             this.$emit('refreshHome');\r\n                         } else {\r\n                             this.$message.success(\"插入失败!\");\r\n                         }\r\n\r\n                     } else {\r\n                         console.log('error submit!!');\r\n                         return false;\r\n                     }\r\n                 });\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]}]}