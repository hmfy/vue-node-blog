{"remainingRequest":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Learn\\blog-person\\src\\components\\EditComments.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Learn\\blog-person\\src\\components\\EditComments.vue","mtime":1578416996537},{"path":"D:\\Learn\\blog-person\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1572976728968},{"path":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js","mtime":1577118252216}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bWFwU3RhdGUsIG1hcEdldHRlcnN9IGZyb20gJ3Z1ZXgnCgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiRWRpdENvbW1lbnRzIiwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVhZGVyTmFtZTogJycsCiAgICAgICAgICAgIGNvbnRlbnQ6ICcnLAogICAgICAgICAgICB2Q29kZTogJycsCiAgICAgICAgICAgIHJpZ2h0Q29kZTogJycsCiAgICAgICAgICAgIHZlcmlmeUNvZGU6ICcnCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBzdWJtaXRDb21tZW50ICgpIHsKICAgICAgICAgICAgY29uc3Qge3JlYWRlck5hbWUsIGNvbnRlbnQsIGdyb3VwLCBwYXJlbnR9ID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXhpb3MoewogICAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgICAgICB1cmw6ICcvc3VibWl0Q29tbWVudCcsCiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXMuJGF0dHJzWyJhcklkIl0sCiAgICAgICAgICAgICAgICAgICAgY3RpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICAgICAgICAgICAgICAgIHJlYWRlck5hbWUsCiAgICAgICAgICAgICAgICAgICAgY29udGVudCwKICAgICAgICAgICAgICAgICAgICBncm91cCwKICAgICAgICAgICAgICAgICAgICBwYXJlbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGFzeW5jIHN1Ym1pdEZvcm0oKSB7CiAgICAgICAgICAgIGxldCBuYW1lID0gdGhpcy5yZWFkZXJOYW1lOwogICAgICAgICAgICBsZXQgY29tbWVudCA9IHRoaXMuY29udGVudDsKICAgICAgICAgICAgY29uc3QgdGVtcFZlcmlmeSA9IHRoaXMudmVyaWZ5Q29kZS50b0xvY2FsZUxvd2VyQ2FzZSgpOwogICAgICAgICAgICBjb25zdCB0ZW1wUmlnaHRDb2RlID0gdGhpcy5yaWdodENvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYgKG5hbWUudHJpbSgpICYmIGNvbW1lbnQudHJpbSgpKSB7CiAgICAgICAgICAgICAgICBpZiAodGVtcFJpZ2h0Q29kZSAhPT0gdGVtcFZlcmlmeSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICLpqozor4HnoIHplJnor69+IiwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyIC0gMTAwLAogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21DbGFzczogJ3NtYWxsLW1lc3NhZ2UnCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnN1Ym1pdENvbW1lbnQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9ICF0aGlzLmNvbW1lbnRTdGF0ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlYWRlck5hbWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSAnJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlcmlmeUNvZGUgPSAnJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCJyZWZyZXNoQ29tbWVudHMiLCBuZXdTdGF0ZSk7IC8vIOaPkOS6pOaXtuinpuWPkeeItue6p+S6i+S7tuabtOaUueeKtuaAgSzooqvlhYTlvJ/nu4Tku7bnm5HlkKzliLAKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoImJsb2cvdXBkYXRlQ29tbWVudFN0YXRlIiwge30pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaEhvbWUoKTsKICAgICAgICAgICAgICAgIH1jYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAi5pi156ew5ZKM5YaF5a656YO95LiN6IO95Li656m65ZOmfiIsCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyIC0gMTAwLAogICAgICAgICAgICAgICAgICAgIGN1c3RvbUNsYXNzOiAnc21hbGwtbWVzc2FnZScKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlZnJlc2hDb2RlKCkgewogICAgICAgICAgICB0aGlzLmF4aW9zKHsKICAgICAgICAgICAgICAgIHVybDogJy9nZXRBQ29kZScKICAgICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgdGhpcy52Q29kZSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0Q29kZSA9IHJlcy5kYXRhLnRleHQ7CiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGhhbmRDbGljaygpIHsKICAgICAgICAgICAgdGhpcy5yZWZyZXNoQ29kZSgpCiAgICAgICAgfSwKICAgICAgICByZXNldFJlcGx5KCkgewogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoImJsb2cvdXBkYXRlQ29tbWVudFN0YXRlIiwge30pCiAgICAgICAgfQogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgLi4ubWFwU3RhdGUoImJsb2ciLCBbImdyb3VwIiwgInBhcmVudCIsICJwZXJzb25OYW1lIl0pLAogICAgICAgIC4uLm1hcEdldHRlcnMoewogICAgICAgICAgICByZXBseTogJ2Jsb2cvcmVwbHknLAogICAgICAgICAgICBwaG9uZTogImdldERldmljZUlzUGhvbmUiCiAgICAgICAgfSksCiAgICAgICAgZ2V0UmVwbHlUaXBzICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVwbHkgPyB0aGlzLnJlcGx5IDogJ0DkvZzogIUnCiAgICAgICAgfSwKICAgICAgICBjb21tZW50U3RhdGUgKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kYXR0cnNbInJlZnJlc2giXQogICAgICAgIH0sCiAgICAgICAgcmVmcmVzaEhvbWUgKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbGlzdGVuZXJzWydyZWZyZXNoSG9tZSddCiAgICAgICAgfQogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICAgICAgdGhpcy5yZWZyZXNoQ29kZSgpOwogICAgfQp9Cg=="},{"version":3,"sources":["EditComments.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditComments.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n    <el-form label-width=\"60px\">\r\n        <template v-if=\"phone\">\r\n            <el-form-item label=\"昵称\">\r\n                <el-input clearable placeholder=\"昵称不要太长哦~\" maxlength=\"8\" show-word-limit v-model=\"readerName\"/>\r\n            </el-form-item>\r\n            <el-form-item label=\"验证码\">\r\n                <el-row :gutter=\"20\">\r\n                    <el-col :span=\"12\" class=\"reset-padding\">\r\n                        <el-input clearable placeholder=\"不区分大小写\" v-model=\"verifyCode\"/>\r\n                    </el-col>\r\n                    <el-col :span=\"10\">\r\n                        <div @click=\"handClick\" class=\"code-pointer\" v-html=\"vCode\"></div>\r\n                    </el-col>\r\n                </el-row>\r\n            </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"昵称\" v-else>\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"6\" class=\"reset-padding\">\r\n                    <el-input clearable placeholder=\"昵称不要太长哦~\" maxlength=\"8\" show-word-limit v-model=\"readerName\"/>\r\n                </el-col>\r\n                <el-col :span=\"12\">\r\n                    <el-form-item label=\"验证码\">\r\n                        <el-row :gutter=\"20\">\r\n                            <el-col :span=\"12\" class=\"reset-padding\">\r\n                                <el-input clearable placeholder=\"不区分大小写\" v-model=\"verifyCode\"/>\r\n                            </el-col>\r\n                            <el-col :span=\"10\">\r\n                                <div @click=\"handClick\" class=\"code-pointer\" v-html=\"vCode\"></div>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-form-item>\r\n                </el-col>\r\n            </el-row>\r\n        </el-form-item>\r\n        <el-form-item label=\"评论\">\r\n             <el-input :class=\"{'input-ident': reply}\" maxlength=\"800\" :autosize=\"{minRows: 8, maxRows: 100 }\" show-word-limit :placeholder=\"getReplyTips\" type=\"textarea\" v-model=\"content\"/>\r\n        </el-form-item>\r\n        <el-form-item>\r\n            <template v-if=\"phone\">\r\n                <el-col :span=\"12\">\r\n                    <el-button @click=\"submitForm\" type=\"primary\">提交</el-button>\r\n                </el-col>\r\n                <transition name=\"el-fade-in-linear\">\r\n                    <el-col :span=\"12\" v-if=\"reply\">\r\n                        <el-button @click=\"resetReply\" type=\"danger\">取消</el-button>\r\n                    </el-col>\r\n                </transition>\r\n            </template>\r\n            <el-row v-else>\r\n                <el-col :span=\"2\">\r\n                    <el-button @click=\"submitForm\" type=\"primary\">提交</el-button>\r\n                </el-col>\r\n                <transition name=\"el-fade-in-linear\">\r\n                    <el-col :span=\"22\" v-if=\"reply\">\r\n                        <el-button @click=\"resetReply\" type=\"danger\">取消</el-button>\r\n                    </el-col>\r\n                </transition>\r\n            </el-row>\r\n        </el-form-item>\r\n    </el-form>\r\n</template>\r\n\r\n<script>\r\n    import {mapState, mapGetters} from 'vuex'\r\n\r\n    export default {\r\n        name: \"EditComments\",\r\n        data() {\r\n            return {\r\n                readerName: '',\r\n                content: '',\r\n                vCode: '',\r\n                rightCode: '',\r\n                verifyCode: ''\r\n            }\r\n        },\r\n        methods: {\r\n            submitComment () {\r\n                const {readerName, content, group, parent} = this;\r\n                return this.axios({\r\n                    method: 'post',\r\n                    url: '/submitComment',\r\n                    data: {\r\n                        id: this.$attrs[\"arId\"],\r\n                        ctime: new Date().getTime(),\r\n                        readerName,\r\n                        content,\r\n                        group,\r\n                        parent\r\n                    }\r\n                })\r\n            },\r\n            async submitForm() {\r\n                let name = this.readerName;\r\n                let comment = this.content;\r\n                const tempVerify = this.verifyCode.toLocaleLowerCase();\r\n                const tempRightCode = this.rightCode.toLocaleLowerCase();\r\n                if (name.trim() && comment.trim()) {\r\n                    if (tempRightCode !== tempVerify) {\r\n                        this.$message.warning({\r\n                            message: \"验证码错误~\",\r\n                            offset: window.innerHeight / 2 - 100,\r\n                            customClass: 'small-message'\r\n                        });\r\n                        return undefined\r\n                    }\r\n                    try {\r\n                        await this.submitComment();\r\n                        const newState = !this.commentState;\r\n                        this.readerName = '';\r\n                        this.content = '';\r\n                        this.verifyCode = '';\r\n                        this.$emit(\"refreshComments\", newState); // 提交时触发父级事件更改状态,被兄弟组件监听到\r\n                        this.$store.commit(\"blog/updateCommentState\", {});\r\n                        this.refreshHome();\r\n                    }catch (err) {\r\n                        console.log(err)\r\n                    }\r\n                } else {\r\n                    this.$message.warning({\r\n                        message: \"昵称和内容都不能为空哦~\",\r\n                        offset: window.innerHeight / 2 - 100,\r\n                        customClass: 'small-message'\r\n                    })\r\n                }\r\n            },\r\n            refreshCode() {\r\n                this.axios({\r\n                    url: '/getACode'\r\n                }).then(res => {\r\n                    this.vCode = res.data.data;\r\n                    this.rightCode = res.data.text;\r\n                }).catch(err => {\r\n                    console.log(err);\r\n                });\r\n            },\r\n            handClick() {\r\n                this.refreshCode()\r\n            },\r\n            resetReply() {\r\n                this.$store.commit(\"blog/updateCommentState\", {})\r\n            }\r\n        },\r\n        computed: {\r\n            ...mapState(\"blog\", [\"group\", \"parent\", \"personName\"]),\r\n            ...mapGetters({\r\n                reply: 'blog/reply',\r\n                phone: \"getDeviceIsPhone\"\r\n            }),\r\n            getReplyTips () {\r\n                return this.reply ? this.reply : '@作者'\r\n            },\r\n            commentState () {\r\n                return this.$attrs[\"refresh\"]\r\n            },\r\n            refreshHome () {\r\n                return this.$listeners['refreshHome']\r\n            }\r\n        },\r\n        created() {\r\n            this.refreshCode();\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .el-form {\r\n        background: #f6f7f7;\r\n        padding: 10px 10px 0 10px;\r\n        margin-top: 20px;\r\n        border: 1px solid #ced1d8;\r\n        border-radius: 2px;\r\n        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1)\r\n    }\r\n\r\n    .code-pointer {\r\n        cursor: pointer;\r\n        line-height: 1;\r\n    }\r\n\r\n    .reset-padding {\r\n        padding-left: 0 !important;\r\n    }\r\n\r\n    .el-link.el-link--danger.is-underline:hover:after, .el-link.el-link--danger:after {\r\n        border-color: transparent;\r\n    }\r\n</style>"]}]}