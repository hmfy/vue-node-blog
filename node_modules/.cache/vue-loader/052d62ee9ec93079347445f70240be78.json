{"remainingRequest":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Learn\\blog-person\\src\\components\\Comments.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Learn\\blog-person\\src\\components\\Comments.vue","mtime":1578417732207},{"path":"D:\\Learn\\blog-person\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1572976728968},{"path":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js","mtime":1577118252216}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEgKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNvbW1lbnRzOiBbXQogICAgICAgIH0KICAgIH0sCiAgICBuYW1lOiAiQ29tbWVudHMiLAogICAgaW5qZWN0OiBbInNjcm9sbFJlcGx5Il0sCiAgICBjb21wdXRlZDogewogICAgICAgIGNvbW1lbnRTdGF0ZSAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiRhdHRyc1sicmVmcmVzaCJdCiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgY29tbWVudFN0YXRlICh2YWwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIOWFhOW8n+e7hOS7tueahOeKtuaAgeS4gOWPkeeUn+aUueWPmCzpqazkuIrph43mlrDor7fmsYLkuIDmrKHmlbDmja7lubbmuLLmn5MKICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0Q29tbWVudHMoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBnZXRQYXJlbnROYW1lKHBhcmVudCwgcGFyZW50T2JqKSB7CiAgICAgICAgICAgIGxldCBjaGlsZExpc3QgPSBwYXJlbnRPYmouY2hpbGRMaXN0OwogICAgICAgICAgICBpZiAocGFyZW50T2JqLmlkID09IHBhcmVudCkgewogICAgICAgICAgICAgICAgaWYgKHBhcmVudE9iai5wYXJlbnQgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICJAIiArIHBhcmVudE9iai5wZXJzb25OYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoaWxkTGlzdCkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5nZXRQYXJlbnROYW1lKHBhcmVudCwgY2hpbGRMaXN0W2ldKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAnY29udGludWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICdjb250aW51ZScgLy8g6Iul5q2k5aSE5pyq6L+U5ZueLOWImeS4iumdoueahGZvcuW+queOr+e7k+adnyzmnIDnu4jnu5PmnpzmuLLmn5MKICAgICAgICB9LAogICAgICAgIGNoYW5nZVN0YXRlICh7Z3JvdXAsIHBhcmVudCwgaWQsIHBlcnNvbk5hbWV9LCBlKSB7CiAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy4kc3RvcmU7CiAgICAgICAgICAgIGlmIChlKXsKICAgICAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnYmxvZy91cGRhdGVDb21tZW50U3RhdGUnLCB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LAogICAgICAgICAgICAgICAgICAgIGdyb3VwLAogICAgICAgICAgICAgICAgICAgIHBlcnNvbk5hbWU6IGUudGFyZ2V0LmlubmVyVGV4dC5zbGljZSgxKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1lbHNlIGlmIChwYXJlbnQgPT0gMCkgewogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICogIOWNs+WwhuaPkOS6pOeahOS6uueahHBhcmVudOaYrzogaWQKICAgICAgICAgICAgICAgICogIOe7hOW6lOivpeaYrzogaWQKICAgICAgICAgICAgICAgICogKi8KICAgICAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnYmxvZy91cGRhdGVDb21tZW50U3RhdGUnLCB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBpZCwKICAgICAgICAgICAgICAgICAgICBncm91cDogaWQsCiAgICAgICAgICAgICAgICAgICAgcGVyc29uTmFtZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgKiAg57uE5bqU6K+l5pivOiBncm91cAogICAgICAgICAgICAgICAgKiAgcGFyZW505pivOiBpZAogICAgICAgICAgICAgICAgKiAqLwogICAgICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdibG9nL3VwZGF0ZUNvbW1lbnRTdGF0ZScsIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IGlkLAogICAgICAgICAgICAgICAgICAgIGdyb3VwOiBncm91cCwKICAgICAgICAgICAgICAgICAgICBwZXJzb25OYW1lCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNjcm9sbFJlcGx5KCk7CiAgICAgICAgfSwKICAgICAgICBnZXRDb21tZW50cyAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmF4aW9zKHsKICAgICAgICAgICAgICAgIHVybDogJy9nZXRDb21tZW50cycsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy4kYXR0cnNbImFySWQiXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgYXN5bmMgZm9ybWF0Q29tbWVudHMgKCkgewogICAgICAgICAgICB0aGlzLmNvbW1lbnRzLmxlbmd0aCA9IDA7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0Q29tbWVudHMoKTsKICAgICAgICAgICAgY29uc3QgYXJyID0gdGhpcy5jb21tZW50czsKICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IFtdOwogICAgICAgICAgICBsZXQgY29tbWVudExpc3QgPSByZXMuZGF0YVswXTsKICAgICAgICAgICAgaWYgKGNvbW1lbnRMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29tbWVudExpc3QuZm9yRWFjaChlbGUgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCBvYmogPSB7fTsKICAgICAgICAgICAgICAgICAgICBvYmouaWQgPSBlbGUuaWQ7CiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQgPSBlbGUuY29tbWVudHM7CiAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGUgPSB0aGlzLiRkYXRlX2Zvcm1hdChlbGUuY3RpbWUpOwogICAgICAgICAgICAgICAgICAgIG9iai5wYXJlbnQgPSBlbGUucGFyZW50OwogICAgICAgICAgICAgICAgICAgIG9iai5wZXJzb25OYW1lID0gZWxlWyd1c2VyX25hbWUnXTsKICAgICAgICAgICAgICAgICAgICBvYmouZ3JvdXAgPSBlbGUubXlfZ3JvdXA7CiAgICAgICAgICAgICAgICAgICAgb2JqLmdvb2QgPSBlbGUuZ29vZDsKICAgICAgICAgICAgICAgICAgICB0ZW1wQXJyLnB1c2gob2JqKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGVtcEFyci5mb3JFYWNoKGVsZSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVsZS5wYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICBlbGUuY2hpbGRMaXN0ID0gW107CiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2goZWxlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wQXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAodGVtcEFycltpXS5wYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGFyci5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcEFycltpXS5ncm91cCA9PSBhcnJbal0uaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycltqXS5jaGlsZExpc3QucHVzaCh0ZW1wQXJyW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZm9ybWF0Q29tbWVudHMoKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["Comments.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Comments.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n    <el-card class=\"box-card\">\r\n        <div v-if=\"comments.length\">\r\n            <div class=\"comments\" v-for=\"(item, index) in comments\">\r\n                <el-row>\r\n                    <el-col :span=\"24\">\r\n                        <div class=\"\">\r\n                            <span class=\"person-name\" @click=\"changeState(item)\"> {{ item.personName }}: </span>\r\n                            {{ item.content }}\r\n                        </div>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <div class=\"date\">{{ item.date }}</div>\r\n                    </el-col>\r\n                    <el-col :span=\"12\" class=\"text-right\">\r\n                        <span class=\"self-pointer\" @click=\"changeState(item)\">ÂõûÂ§ç</span>\r\n                       <!-- <el-divider direction=\"vertical\"></el-divider>\r\n                        <span class=\"self-pointer\">ÁÇπËµû({{ item.good }})</span>-->\r\n                    </el-col>\r\n                </el-row>\r\n                <div class=\"child\" v-for=\"child in item.childList\">\r\n                    <el-row>\r\n                        <el-col :span=\"24\">\r\n                            <div class=\"\">\r\n                                <span class=\"person-name\" @click=\"changeState(child)\"> {{ child.personName }}: </span>\r\n                                <span class=\"person-name reply-color\" @click=\"changeState(child, $event)\">\r\n                                    {{ getParentName(child.parent, comments[index]) }}\r\n                                </span>\r\n                                {{ child.content }}\r\n                            </div>\r\n                        </el-col>\r\n                    </el-row>\r\n                    <el-row>\r\n                        <el-col :span=\"12\">\r\n                            <div class=\"date\">{{ child.date }}</div>\r\n                        </el-col>\r\n                        <el-col :span=\"12\" class=\"text-right\">\r\n                            <span class=\"self-pointer\" @click=\"changeState(child)\">ÂõûÂ§ç</span>\r\n                            <!--<el-divider direction=\"vertical\"></el-divider>\r\n                            <span class=\"self-pointer\">ÁÇπËµû({{ child.good }})</span>-->\r\n                        </el-col>\r\n                    </el-row>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-else class=\"empty-text\">ÊöÇÊó∂ËøòÊ≤°Êúâ‰∫∫ÁïôË®Ä,Âø´Êù•Êä¢Ê≤ôÂèëÂêßüòÄ</div>\r\n    </el-card>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        data () {\r\n            return {\r\n                comments: []\r\n            }\r\n        },\r\n        name: \"Comments\",\r\n        inject: [\"scrollReply\"],\r\n        computed: {\r\n            commentState () {\r\n                return this.$attrs[\"refresh\"]\r\n            }\r\n        },\r\n        watch: {\r\n            commentState (val) {\r\n                try {\r\n                    // ÂÖÑÂºüÁªÑ‰ª∂ÁöÑÁä∂ÊÄÅ‰∏ÄÂèëÁîüÊîπÂèò,È©¨‰∏äÈáçÊñ∞ËØ∑Ê±Ç‰∏ÄÊ¨°Êï∞ÊçÆÂπ∂Ê∏≤Êüì\r\n                    this.formatComments();\r\n                } catch (err) {\r\n                    console.log(err);\r\n                }\r\n            }\r\n        },\r\n        methods: {\r\n            getParentName(parent, parentObj) {\r\n                let childList = parentObj.childList;\r\n                if (parentObj.id == parent) {\r\n                    if (parentObj.parent == 0) {\r\n                        return \"\"\r\n                    }\r\n                    return \"@\" + parentObj.personName\r\n                }\r\n                if (childList) {\r\n                    for (let i = 0; i < childList.length; i++) {\r\n                        let result = this.getParentName(parent, childList[i]);\r\n                        if (result !== 'continue') {\r\n                            return result\r\n                        }\r\n                    }\r\n                }\r\n                return 'continue' // Ëã•Ê≠§Â§ÑÊú™ËøîÂõû,Âàô‰∏äÈù¢ÁöÑforÂæ™ÁéØÁªìÊùü,ÊúÄÁªàÁªìÊûúÊ∏≤Êüì\r\n            },\r\n            changeState ({group, parent, id, personName}, e) {\r\n                const store = this.$store;\r\n                if (e){\r\n                    store.commit('blog/updateCommentState', {\r\n                        parent,\r\n                        group,\r\n                        personName: e.target.innerText.slice(1)\r\n                    });\r\n                }else if (parent == 0) {\r\n                    /*\r\n                    *  Âç≥Â∞ÜÊèê‰∫§ÁöÑ‰∫∫ÁöÑparentÊòØ: id\r\n                    *  ÁªÑÂ∫îËØ•ÊòØ: id\r\n                    * */\r\n                    store.commit('blog/updateCommentState', {\r\n                        parent: id,\r\n                        group: id,\r\n                        personName\r\n                    });\r\n                } else {\r\n                    /*\r\n                    *  ÁªÑÂ∫îËØ•ÊòØ: group\r\n                    *  parentÊòØ: id\r\n                    * */\r\n                    store.commit('blog/updateCommentState', {\r\n                        parent: id,\r\n                        group: group,\r\n                        personName\r\n                    });\r\n                }\r\n                this.scrollReply();\r\n            },\r\n            getComments () {\r\n                return this.axios({\r\n                    url: '/getComments',\r\n                    params: {\r\n                        id: this.$attrs[\"arId\"]\r\n                    }\r\n                })\r\n            },\r\n            async formatComments () {\r\n                this.comments.length = 0;\r\n                const res = await this.getComments();\r\n                const arr = this.comments;\r\n                const tempArr = [];\r\n                let commentList = res.data[0];\r\n                if (commentList.length) {\r\n                    commentList.forEach(ele => {\r\n                        let obj = {};\r\n                        obj.id = ele.id;\r\n                        obj.content = ele.comments;\r\n                        obj.date = this.$date_format(ele.ctime);\r\n                        obj.parent = ele.parent;\r\n                        obj.personName = ele['user_name'];\r\n                        obj.group = ele.my_group;\r\n                        obj.good = ele.good;\r\n                        tempArr.push(obj);\r\n                    })\r\n                }\r\n                tempArr.forEach(ele => {\r\n                    if (!ele.parent) {\r\n                        ele.childList = [];\r\n                        arr.push(ele)\r\n                    }\r\n                });\r\n                for (let i = 0; i < tempArr.length; i++) {\r\n                    if (tempArr[i].parent) {\r\n                        for (let j = 0; j < arr.length; j++) {\r\n                            if (tempArr[i].group == arr[j].id) {\r\n                                arr[j].childList.push(tempArr[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        created() {\r\n            try {\r\n                this.formatComments();\r\n            } catch (err) {\r\n                console.log(err);\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .text-right {\r\n        text-align: right;\r\n    }\r\n\r\n    .el-row {\r\n        padding-top: 3px;\r\n        line-height: 1.5;\r\n    }\r\n\r\n    .el-row:first-child {\r\n        padding: 0;\r\n    }\r\n\r\n    .comments {\r\n        padding-bottom: 15px;\r\n    }\r\n\r\n    .comments:last-child,\r\n    .child:last-child {\r\n        padding-bottom: 0;\r\n        border-bottom: none;\r\n    }\r\n\r\n    .child {\r\n        font-size: 14px;\r\n        /*margin-top: 5px;*/\r\n        padding: 5px 10px 5px 20px;\r\n        background: #d9edf7;\r\n        border-bottom: 1px dashed #dedede;\r\n    }\r\n\r\n    .person-name {\r\n        color: #3a9af1;\r\n        cursor: pointer;\r\n    }\r\n\r\n    .date {\r\n        color: #909399;\r\n    }\r\n\r\n    .self-pointer {\r\n        cursor: pointer;\r\n        color: #909399;\r\n    }\r\n\r\n    .self-pointer:hover {\r\n        color: #409EFF;\r\n    }\r\n\r\n    .empty-text {\r\n        height: 50px;\r\n        color: #909399;\r\n    }\r\n    .reply-color {\r\n        color: #7331f1;\r\n    }\r\n</style>"]}]}