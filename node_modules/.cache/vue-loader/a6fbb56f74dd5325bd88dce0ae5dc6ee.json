{"remainingRequest":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Learn\\blog-person\\src\\views\\BlogDetail.vue?vue&type=style&index=0&id=6081ba66&scoped=true&lang=css&","dependencies":[{"path":"D:\\Learn\\blog-person\\src\\views\\BlogDetail.vue","mtime":1578496070935},{"path":"D:\\Learn\\blog-person\\node_modules\\css-loader\\dist\\cjs.js","mtime":1577118249893},{"path":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1577118252216},{"path":"D:\\Learn\\blog-person\\node_modules\\postcss-loader\\src\\index.js","mtime":1572976729857},{"path":"D:\\Learn\\blog-person\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1572976728968},{"path":"D:\\Learn\\blog-person\\node_modules\\vue-loader\\lib\\index.js","mtime":1577118252216}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYm94LWNhcmQ6bnRoLW9mLXR5cGUoMikgewogICAgbWFyZ2luLXRvcDogMjBweDsKfQoKLmJsb2ctcmVwbHktZ29vZCB7CiAgICBwYWRkaW5nLXJpZ2h0OiAxNXB4OwogICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi5ibG9nLXJlcGx5LWdvb2QgPiBzcGFuOmhvdmVyIHsKICAgIGNvbG9yOiAjNDA5RUZGOwp9CgouYmxvZy10aXRsZSB7CiAgICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KCi5ibG9nLXRpdGxlID4gaDEgewogICAgZm9udC1zaXplOiAzMHB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBwYWRkaW5nOiAxNXB4IDAgMTBweCAwOwogICAgZm9udC1mYW1pbHk6ICJIZWx2ZXRpY2EgTmV1ZSIsIEhlbHZldGljYSwgIlBpbmdGYW5nIFNDIiwgIkhpcmFnaW5vIFNhbnMgR0IiLCAiTWljcm9zb2Z0IFlhSGVpIiwgIuW+rui9r+mbhem7kSIsIEFyaWFsLCBzYW5zLXNlcmlmOwp9CgouYmxvZy10aXRsZSA+IHAgewogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkZWRlZGU7CiAgICBwYWRkaW5nLWJvdHRvbTogNXB4Owp9CgouYmxvZy10aXRsZSA+IHAgPiBzcGFuIHsKICAgIGxpbmUtaGVpZ2h0OiAxLjU7CiAgICBjb2xvcjogIzk2OTY5NjsKfQoKLmJsb2ctdGl0bGUgPiBwID4gLmVsLXRhZyB7CiAgICBsaW5lLWhlaWdodDogMTdweDsKICAgIGhlaWdodDogMjBweDsKICAgIHBhZGRpbmc6IDAgNXB4OwogICAgbWFyZ2luLWxlZnQ6IDVweDsKICAgIGNvbG9yOiAjNjdjMjNhOwp9CgouYmxvZy10aXRsZSA+IHAgPiBzcGFuLnJlc2V0LWxlZnQtbWFyZ2luIHsKICAgIG1hcmdpbi1sZWZ0OiAwOwp9CgouYmxvZy1yZXBseS1nb29kIHNwYW4uc2VsZi1nb29kIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIHdpZHRoOiA2NXB4OwogICAgdmVydGljYWwtYWxpZ246IGJvdHRvbTsKICAgIGhlaWdodDogNjVweDsKICAgIGJhY2tncm91bmQ6IHVybCgiLi4vYXNzZXRzL2ltZy9oZWFydC5wbmciKSBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMTVweCAtMTBweDsKICAgIHRyYW5zZm9ybTogc2NhbGUoMC42KSB0cmFuc2xhdGUoMjNweCwgMzNweCk7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtd2Via2l0LXRyYW5zaXRpb246IGJhY2tncm91bmQtcG9zaXRpb24gMXMgc3RlcHMoMjgpOwogICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1wb3NpdGlvbiAxcyBzdGVwcygyOCk7CiAgICAtd2Via2l0LXRyYW5zaXRpb24tZHVyYXRpb246IDBzOwogICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogMHM7Cn0KCi5ibG9nLXJlcGx5LWdvb2Qgc3Bhbi5zZWxmLWdvb2QuaXMtYWN0aXZlIHsKICAgIC13ZWJraXQtdHJhbnNpdGlvbi1kdXJhdGlvbjogMXM7CiAgICB0cmFuc2l0aW9uLWR1cmF0aW9uOiAxczsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IC0yODE1cHggLTEwcHg7Cn0K"},{"version":3,"sources":["BlogDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6NA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"BlogDetail.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n    <div>\r\n        <el-card class=\"box-card\">\r\n            <div class=\"blog-title\">\r\n                <h1>{{ currentArticle.title }}</h1>\r\n                <p>\r\n                    <span class=\"reset-left-margin\">{{ $date_format(currentArticle.ctime) }}</span>\r\n                    <el-divider direction=\"vertical\" v-if=\"!phone\"/>\r\n                    <br v-if=\"phone\">\r\n                    <span :class=\"{'reset-left-margin': phone}\">阅读 {{ currentArticle.views || 0 }}</span>\r\n                    <el-divider direction=\"vertical\"/>\r\n                    <span>评论 {{ currentArticle.commentCount }}</span>\r\n                    <el-divider direction=\"vertical\"/>\r\n                    <el-tag type=\"success\" v-for=\"tag in currentArticle.tags.split(',')\">{{ tag }}</el-tag>\r\n                </p>\r\n            </div>\r\n            <div class=\"ql-snow\">\r\n                <div class=\"ql-editor\" v-html=\"currentArticle.content\"></div>\r\n            </div>\r\n            <div class=\"blog-reply-good\">\r\n                <el-tooltip effect=\"light\" :content=\"goodContent\" placement=\"top-start\">\r\n                    <span class=\"self-good\" :class=\"{'is-active': goodState}\" @click=\"updateGoods\"></span>\r\n                </el-tooltip>\r\n                ({{ currentArticle.good || 0 }})\r\n                <el-divider direction=\"vertical\"/>\r\n                <span @click=\"changeState\">评论</span>\r\n            </div>\r\n        </el-card>\r\n        <!--评论区-->\r\n        <comments :arId=\"articleId\" :refresh=\"commentState\"/>\r\n        <!--留言板-->\r\n        <edit-comments :arId=\"articleId\" :refresh=\"commentState\" @refreshComments=\"updateList\" v-on=\"$listeners\"/>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import Comments from \"../components/Comments\";\r\n    import EditComments from \"../components/EditComments\";\r\n    import {mapGetters} from \"vuex\";\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                currentArticle: {\r\n                    title: '',\r\n                    content: '',\r\n                    views: 0,\r\n                    ctime: '2019-01-01',\r\n                    tags: '',\r\n                    commentCount: ''\r\n                },\r\n                articleId: 0,\r\n                commentState: false,\r\n                goodState: false,\r\n                goodContent: '来点个赞吧~'\r\n            }\r\n        },\r\n        components: {\r\n            Comments,\r\n            EditComments\r\n        },\r\n        computed: {\r\n            ...mapGetters({\r\n                phone: \"getDeviceIsPhone\"\r\n            }),\r\n            ...mapGetters({\r\n                ip: \"getIP\"\r\n            })\r\n        },\r\n        provide() {\r\n            return {\r\n                scrollReply: this.scrollReply\r\n            }\r\n        },\r\n        name: \"blogDetail\",\r\n        methods: {\r\n            changeState() {\r\n                this.$store.commit(\"blog/updateCommentState\", {});\r\n                this.scrollReply();\r\n            },\r\n            scrollReply() {\r\n                const offsetHeight = document.documentElement.offsetHeight;\r\n                const windowHeight = window.innerHeight;\r\n\r\n                function step() {\r\n                    window.scrollTo(0, window.scrollY + 40);\r\n                    if (window.scrollY < offsetHeight - windowHeight) {\r\n                        requestAnimationFrame(step);\r\n                    }\r\n                }\r\n\r\n                requestAnimationFrame(step);\r\n            },\r\n            async updateList(state) {\r\n                this.commentState = state; // 提交组件提及时触发父级事件改变状态,被另一子组件监听到\r\n\r\n                const res = await this.getArticleDetail();\r\n                const result = res.data[0].length && res.data[0][0];\r\n                this.currentArticle.commentCount = result.commentCount;\r\n            },\r\n            addGood () {\r\n                // 更新点赞数\r\n                return this.axios({\r\n                    method: 'post',\r\n                    url: '/updateGoods',\r\n                    data: {\r\n                        ip: this.ip,\r\n                        id: this.articleId,\r\n                        vTime: new Date().getTime(),\r\n                        type: 1 //暂时只开放文章点赞(1为文章,2为评论)\r\n                    }\r\n                })\r\n            },\r\n            async updateGoods () {\r\n                try {\r\n                    if (this.goodState) {\r\n                        // 您已经点过赞咯!\r\n                        // 弹窗提示\r\n\r\n                    } else {\r\n                        this.goodState = true;\r\n                        this.goodContent = '您已经点过赞了哟~';\r\n                        await this.addGood();\r\n                        const res = await this.getArticleDetail();\r\n                        const result = res.data[0].length && res.data[0][0];\r\n                        this.currentArticle.good = result.good;\r\n                        // 点赞动画开始\r\n                    }\r\n                }catch (e) {\r\n                    console.log(e)\r\n                }\r\n            },\r\n            getArticleDetail () {\r\n                // 获取文章详细信息\r\n                return this.axios({\r\n                    url: '/getArticleDetail',\r\n                    params: {\r\n                        id: this.articleId\r\n                    }\r\n                })\r\n            },\r\n            getReader() {\r\n                // 获取读者基本信息(24小时内是否阅读过)\r\n                return this.axios({\r\n                    url: '/getViewsInfo',\r\n                    params: {\r\n                        ip: this.ip,\r\n                        id: this.articleId\r\n                    }\r\n                })\r\n            },\r\n            updateViews() {\r\n                // 更新文章阅读量以及blog_views表(暂时还没想好)\r\n                this.axios({\r\n                    method: 'post',\r\n                    url: '/setViews',\r\n                    data: {\r\n                        ip: this.ip,\r\n                        id: this.articleId,\r\n                        vTime: new Date().getTime()\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        async created() {\r\n            let id = this.$route.params[\"id\"];\r\n            if (id) {\r\n                sessionStorage.setItem(\"currArticle\", id);\r\n            } else {\r\n                id = sessionStorage.getItem(\"currArticle\");\r\n            }\r\n            this.articleId = id;\r\n\r\n            try {\r\n                const res = await this.getArticleDetail();\r\n                const result = res.data[0].length && res.data[0][0];\r\n                this.currentArticle.commentCount = result.commentCount;\r\n                this.currentArticle = result;\r\n                this.currentArticle.title = result.title;\r\n                this.currentArticle.content = result.content;\r\n                this.currentArticle.views = result.views;\r\n                this.currentArticle.tags = result.tags;\r\n                this.currentArticle.good = result.good;\r\n                this.currentArticle.ctime = result.ctime;\r\n            }catch (e) {\r\n                console.log(e)\r\n            }\r\n        },\r\n        async beforeMount() {\r\n            const store = this.$store;\r\n            store.commit(\"setLeftTagsLine\", {\r\n                leftCol: 24\r\n            });\r\n\r\n            // 文章阅读量更新操作...\r\n            try {\r\n                const readerResult = await this.getReader();\r\n                const data = readerResult.data[0];\r\n                if (readerResult.data[1].length) {\r\n                    // 当前用户已经点赞过(限IP)\r\n                    this.goodState = true;\r\n                    this.goodContent = '您已经点过赞了哟~';\r\n                }\r\n                if (data.length) {\r\n                    const vTime = data[0]['vtime'];\r\n                    let difference = (new Date().getTime() - vTime) / 1000 / 60 / 60;\r\n                    if (difference > 24) {\r\n                        // 一天内的阅读次数只算一次\r\n                        await this.updateViews();\r\n                    }\r\n                } else {\r\n                    await this.updateViews();\r\n                }\r\n            }catch (e) {\r\n                console.log(e)\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .box-card:nth-of-type(2) {\r\n        margin-top: 20px;\r\n    }\r\n\r\n    .blog-reply-good {\r\n        padding-right: 15px;\r\n        text-align: right;\r\n        cursor: pointer;\r\n    }\r\n\r\n    .blog-reply-good > span:hover {\r\n        color: #409EFF;\r\n    }\r\n\r\n    .blog-title {\r\n        padding-left: 15px;\r\n    }\r\n\r\n    .blog-title > h1 {\r\n        font-size: 30px;\r\n        font-weight: bold;\r\n        padding: 15px 0 10px 0;\r\n        font-family: \"Helvetica Neue\", Helvetica, \"PingFang SC\", \"Hiragino Sans GB\", \"Microsoft YaHei\", \"微软雅黑\", Arial, sans-serif;\r\n    }\r\n\r\n    .blog-title > p {\r\n        border-bottom: 1px solid #dedede;\r\n        padding-bottom: 5px;\r\n    }\r\n\r\n    .blog-title > p > span {\r\n        line-height: 1.5;\r\n        color: #969696;\r\n    }\r\n\r\n    .blog-title > p > .el-tag {\r\n        line-height: 17px;\r\n        height: 20px;\r\n        padding: 0 5px;\r\n        margin-left: 5px;\r\n        color: #67c23a;\r\n    }\r\n\r\n    .blog-title > p > span.reset-left-margin {\r\n        margin-left: 0;\r\n    }\r\n\r\n    .blog-reply-good span.self-good {\r\n        display: inline-block;\r\n        width: 65px;\r\n        vertical-align: bottom;\r\n        height: 65px;\r\n        background: url(\"../assets/img/heart.png\") no-repeat;\r\n        background-position: -15px -10px;\r\n        transform: scale(0.6) translate(23px, 33px);\r\n        cursor: pointer;\r\n        -webkit-transition: background-position 1s steps(28);\r\n        transition: background-position 1s steps(28);\r\n        -webkit-transition-duration: 0s;\r\n        transition-duration: 0s;\r\n    }\r\n\r\n    .blog-reply-good span.self-good.is-active {\r\n        -webkit-transition-duration: 1s;\r\n        transition-duration: 1s;\r\n        background-position: -2815px -10px;\r\n    }\r\n</style>"]}]}